$(document).ready(function () {

    //添加任务
    $("#AddTask").click(function () {
        var msg = layer.msg('正在执行中...', { icon: 16, shade: 0.1, time: 0 });
        $.post("/TaskList/AddTask", { taskContext: $("#taskContext").val() }, function (data) {
            layer.close(msg);
            AjaxDataToastShow(data);
            location.reload();
        });
    });

    //获取任务列表
    $.post("/TaskList/GetTaskListByUserId", function (data) {
        if (data.Success === "success") {
            var jsonList = eval('(' + data.JsonMsg + ')');
            var listhtml = "";
            var progresshtml = "";
            var overhtml = "";
            for (var i = 0; i < jsonList.length; i++) {
                var htmltemp = ' <li class="' + jsonList[i].TaskType + '" id="' + jsonList[i].Id + '">' + jsonList[i].TaskContext + '，' +
                                    '<div class="agile-detail">' +
                                        '<button  class="pull-right btn btn-xs btn-white" onClick="UpdateTaskType(' + jsonList[i].Id + ')"><i class="fa fa-exclamation-triangle"></i></button>' +
                                        '<button  class="pull-right btn btn-xs btn-white"><i class="fa fa-street-view"></i></button>' +
                                        '<button  class="pull-right btn btn-xs btn-white" onClick="DelTask(' + jsonList[i].Id + ') "><i class="fa fa-trash"></i></button>' +
                                        '<i class="fa fa-clock-o"></i> ' + jsonList[i].CreateDate +
                                    '</div>' +
                                '</li>';

                if (jsonList[i].TaskState === "list") {
                    listhtml += htmltemp;
                } else if (jsonList[i].TaskState === "progress") {
                    progresshtml += htmltemp;
                } else {
                    overhtml += htmltemp;
                }
            }

            $("#list").html(listhtml);
            $("#progress").html(progresshtml);
            $("#over").html(overhtml);

        } else {
            AjaxDataToastShow(JSON.stringify(data));
        }

    }, "json");

    //拖动排序
    $(".sortable-list").sortable({
        connectWith: ".connectList",
        update: function () {
            var obj = $(this);
            var value = obj.sortable('toArray');
            $.post("/TaskList/UpdateMyTask", { taskList: value, taskType: obj.attr("name") }, function (data) {

                var msg = eval('(' + data + ')');
                if (msg.Success === "error")
                    location.reload();
                AjaxDataToastShow(data);
            });
        }
    }).disableSelection();

});


//删除任务
function DelTask(id) {
    swal({
        title: "您确定要处理这条信息吗",
        text: "处理后将无法恢复，请谨慎操作！",
        type: "warning",
        showCancelButton: true,
        confirmButtonColor: "#DD6B55",
        confirmButtonText: "是的，我要处理！",
        cancelButtonText: "让我再考虑一下…"
    }, function (isConfirm) {
        if (isConfirm) {
            var msg = layer.msg('正在执行中...', { icon: 16, shade: 0.1, time: 0 });
            $.post("/TaskList/DekTask", { id: id }, function (data) {
                layer.close(msg);
                AjaxDataToastShow(data);
                location.reload();
            });
        } else {
            swal("已取消", "您取消了处理操作！", "error");
        }
    });
}

//更改任务状态
function UpdateTaskType(id) {
    swal({
        title: "更改任务紧急类型",
        text: "更改后将无法恢复到正常状态！",
        type: "warning",
        showCancelButton: true,
        confirmButtonColor: "#DD6B55",
        confirmButtonText: "警告",
        cancelButtonText: "异常"
    }, function (isConfirm) {
        if (isConfirm) {
            var msg = layer.msg('正在执行中...', { icon: 16, shade: 0.1, time: 0 });
            $.post("", {}, function () {

                layer.close(msg);
            });
        } else {
            var msg = layer.msg('正在执行中...', { icon: 16, shade: 0.1, time: 0 });
            $.post("", {}, function () {

                layer.close(msg);
            });
        }
    });


}